# Articles API Documentation

## Base URL
```
http://localhost:5000/api/v1/articles
```

## Overview
This API provides comprehensive article management capabilities including CRUD operations, version management, and publishing functionality. Articles can have multiple versions and can be published to domains.

---

## üìù Article Data Structure

### Article Model
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "domain_id": "123e4567-e89b-12d3-a456-426614174001",
  "slug": "sample-article",
  "status": "DRAFT",
  "created_at": "2024-01-01T00:00:00.000Z",
  "updated_at": "2024-01-01T00:00:00.000Z",
  "baclink_expiry": "2024-12-31T23:59:59.000Z",
  "user": "john.doe",
  "topic": "Technology",
  "niche": "Web Development",
  "keyword": "React",
  "backlink_target": "https://example.com",
  "anchor": "Learn React",
  "selected_version_id": "123e4567-e89b-12d3-a456-426614174002",
  "domain": {
    "id": "123e4567-e89b-12d3-a456-426614174001",
    "slug": "my-website",
    "name": "My Website",
    "url": "https://mywebsite.com",
    "tags": "blog, tech",
    "created_at": "2024-01-01T00:00:00.000Z"
  },
  "versions": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174002",
      "article_id": "123e4567-e89b-12d3-a456-426614174000",
      "version_num": 1,
      "content_md": "# Sample Article\n\nThis is a sample article content.",
      "qc_attempts": 0,
      "last_qc_status": null,
      "last_qc_notes": null,
      "created_at": "2024-01-01T00:00:00.000Z",
      "prompt": "Write about React development"
    }
  ]
}
```

### Article Status Values
- `DRAFT` - Article is in draft state
- `PUBLISHED` - Article has been published
- `ARCHIVED` - Article has been archived
- `PENDING` - Article is pending review
- `GENERATED` - Article was generated by AI
- `FLAGGED_BY_AI` - Article was flagged by AI quality check
- `APPROVED_BY_AI` - Article was approved by AI quality check

---

## üîß CRUD Operations

### 1. Get All Articles
**GET** `/getAllArticles`

Retrieves all articles with their versions and domain information.

**Response:**
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "domain_id": "123e4567-e89b-12d3-a456-426614174001",
    "slug": "sample-article",
    "status": "DRAFT",
    "created_at": "2024-01-01T00:00:00.000Z",
    "updated_at": "2024-01-01T00:00:00.000Z",
    "user": "john.doe",
    "topic": "Technology",
    "niche": "Web Development",
    "keyword": "React",
    "backlink_target": "https://example.com",
    "anchor": "Learn React",
    "selected_version_id": "123e4567-e89b-12d3-a456-426614174002",
    "domain": {
      "id": "123e4567-e89b-12d3-a456-426614174001",
      "slug": "my-website",
      "name": "My Website",
      "url": "https://mywebsite.com",
      "tags": "blog, tech",
      "created_at": "2024-01-01T00:00:00.000Z"
    },
    "versions": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174002",
        "article_id": "123e4567-e89b-12d3-a456-426614174000",
        "version_num": 1,
        "content_md": "# Sample Article\n\nThis is a sample article content.",
        "qc_attempts": 0,
        "last_qc_status": null,
        "last_qc_notes": null,
        "created_at": "2024-01-01T00:00:00.000Z",
        "prompt": "Write about React development"
      }
    ]
  }
]
```

### 2. Get Article by ID
**GET** `/getArticleById/:id`

Retrieves a specific article by its ID with all versions and domain information.

**Parameters:**
- `id` (required): The UUID of the article

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "domain_id": "123e4567-e89b-12d3-a456-426614174001",
  "slug": "sample-article",
  "status": "DRAFT",
  "created_at": "2024-01-01T00:00:00.000Z",
  "updated_at": "2024-01-01T00:00:00.000Z",
  "user": "john.doe",
  "topic": "Technology",
  "niche": "Web Development",
  "keyword": "React",
  "backlink_target": "https://example.com",
  "anchor": "Learn React",
  "selected_version_id": "123e4567-e89b-12d3-a456-426614174002",
  "domain": {
    "id": "123e4567-e89b-12d3-a456-426614174001",
    "slug": "my-website",
    "name": "My Website",
    "url": "https://mywebsite.com",
    "tags": "blog, tech",
    "created_at": "2024-01-01T00:00:00.000Z"
  },
  "versions": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174002",
      "article_id": "123e4567-e89b-12d3-a456-426614174000",
      "version_num": 1,
      "content_md": "# Sample Article\n\nThis is a sample article content.",
      "qc_attempts": 0,
      "last_qc_status": null,
      "last_qc_notes": null,
      "created_at": "2024-01-01T00:00:00.000Z",
      "prompt": "Write about React development"
    }
  ]
}
```

**Error Response (404):**
```json
{
  "error": "Article not found"
}
```

### 3. Update Article
**PUT** `/updateArticle/:id`

Updates an existing article with new data. Only the fields provided will be updated.

**Parameters:**
- `id` (required): The UUID of the article

**Request Body:**
```json
{
  "status": "DRAFT",
  "user": "john.doe",
  "topic": "Updated Technology Topic",
  "niche": "Updated Web Development",
  "keyword": "Updated React",
  "backlink_target": "https://updated-example.com",
  "anchor": "Updated Learn React"
}
```

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "domain_id": "123e4567-e89b-12d3-a456-426614174001",
  "slug": "sample-article",
  "status": "DRAFT",
  "created_at": "2024-01-01T00:00:00.000Z",
  "updated_at": "2024-01-02T00:00:00.000Z",
  "user": "john.doe",
  "topic": "Updated Technology Topic",
  "niche": "Updated Web Development",
  "keyword": "Updated React",
  "backlink_target": "https://updated-example.com",
  "anchor": "Updated Learn React"
}
```

### 4. Delete Article
**DELETE** `/deleteArticle/:id`

Deletes an article and all its associated versions from the database.

**Parameters:**
- `id` (required): The UUID of the article

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "domain_id": "123e4567-e89b-12d3-a456-426614174001",
  "slug": "sample-article",
  "status": "DRAFT",
  "created_at": "2024-01-01T00:00:00.000Z",
  "updated_at": "2024-01-01T00:00:00.000Z",
  "user": "john.doe",
  "topic": "Technology",
  "niche": "Web Development",
  "keyword": "React",
  "backlink_target": "https://example.com",
  "anchor": "Learn React"
}
```

---

## üìã Version Management

### 5. Set Selected Version
**POST** `/setSelectedVersion/:id`

Sets the selected version for an article. This version will be used when publishing the article.

**Parameters:**
- `id` (required): The UUID of the article

**Request Body:**
```json
{
  "versionId": "123e4567-e89b-12d3-a456-426614174002"
}
```

**Response:**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "domain_id": "123e4567-e89b-12d3-a456-426614174001",
  "slug": "sample-article",
  "status": "DRAFT",
  "created_at": "2024-01-01T00:00:00.000Z",
  "updated_at": "2024-01-01T00:00:00.000Z",
  "selected_version_id": "123e4567-e89b-12d3-a456-426614174002"
}
```

**Error Response (400):**
```json
{
  "error": "Missing versionId"
}
```

---

## üöÄ Publishing Operations

### 6. Publish Blog
**POST** `/publishBlog/:id`

Publishes an article to its associated domain. This will:
1. Check if the article has a domain
2. Verify the domain folder exists
3. Get the selected version content
4. Create a markdown file in the domain's content folder
5. Update the article status to 'published'

**Parameters:**
- `id` (required): The UUID of the article

**Response:**
```json
{
  "success": true,
  "message": "Blog published",
  "articleId": "123e4567-e89b-12d3-a456-426614174000",
  "file": "sample-article.md"
}
```

**Error Responses:**

**Article Not Found (404):**
```json
{
  "error": "Article not found"
}
```

**No Domain (400):**
```json
{
  "error": "Article has no domain"
}
```

**Domain Folder Missing (400):**
```json
{
  "error": "Domain folder does not exist"
}
```

**No Selected Version (400):**
```json
{
  "error": "No selected version for this article"
}
```

---

## üìã Error Responses

All endpoints return consistent error responses:

```json
{
  "error": "Error message description"
}
```

Common HTTP status codes:
- `200` - Success
- `400` - Bad Request (missing required fields, validation errors)
- `404` - Not Found (article not found)
- `500` - Internal Server Error

---

## üöÄ Usage Examples

### Complete Workflow Example

1. **Get All Articles:**
   ```bash
   GET /api/v1/articles/getAllArticles
   ```

2. **Get Specific Article:**
   ```bash
   GET /api/v1/articles/getArticleById/123e4567-e89b-12d3-a456-426614174000
   ```

3. **Update Article:**
   ```bash
   PUT /api/v1/articles/updateArticle/123e4567-e89b-12d3-a456-426614174000
   Content-Type: application/json
   
   {
     "status": "DRAFT",
     "topic": "Updated Technology Topic"
   }
   ```

4. **Set Selected Version:**
   ```bash
   POST /api/v1/articles/setSelectedVersion/123e4567-e89b-12d3-a456-426614174000
   Content-Type: application/json
   
   {
     "versionId": "123e4567-e89b-12d3-a456-426614174002"
   }
   ```

5. **Publish Article:**
   ```bash
   POST /api/v1/articles/publishBlog/123e4567-e89b-12d3-a456-426614174000
   ```

6. **Delete Article:**
   ```bash
   DELETE /api/v1/articles/deleteArticle/123e4567-e89b-12d3-a456-426614174000
   ```

---

## üì¶ Postman Collection

Import the provided Postman collection (`Articles_API_Collection.json`) to get all endpoints with sample data pre-configured.

The collection includes:
- All 6 API endpoints
- Sample request bodies
- Environment variables
- Organized folders by operation type
- Example responses for success and error cases

### Environment Variables
- `baseUrl`: `http://localhost:5000`
- `articleId`: Sample article UUID
- `versionId`: Sample version UUID

---

## üîó Related APIs

This Articles API works in conjunction with:
- **Domain API**: For domain management and publishing
- **AI API**: For article generation and quality checks
- **SSG API**: For static site generation

---

## üìä Database Schema

### Article Table
- `id` (UUID, Primary Key)
- `domain_id` (UUID, Foreign Key to Domain)
- `slug` (String, Unique)
- `status` (String, Enum)
- `created_at` (Timestamp)
- `updated_at` (Timestamp)
- `baclink_expiry` (Timestamp, Optional)
- `user` (String, Optional)
- `topic` (String, Optional)
- `niche` (String, Optional)
- `keyword` (String, Optional)
- `backlink_target` (String, Optional)
- `anchor` (String, Optional)
- `selected_version_id` (UUID, Foreign Key to ArticleVersion)

### ArticleVersion Table
- `id` (UUID, Primary Key)
- `article_id` (UUID, Foreign Key to Article)
- `version_num` (Integer)
- `content_md` (Text)
- `qc_attempts` (Integer, Default: 0)
- `last_qc_status` (String, Optional)
- `last_qc_notes` (JSON, Optional)
- `created_at` (Timestamp)
- `prompt` (String, Optional)

### Relationships
- Article ‚Üí Domain (Many-to-One)
- Article ‚Üí ArticleVersion (One-to-Many)
- Article ‚Üí ArticleVersion (One-to-One for selected version) 